#!/bin/sh
# Commit message hook for BigData project
# Validates commit message format

commit_file="$1"
commit_msg=$(cat "$commit_file")

echo "üìù Validating commit message format..."

# Check for conventional commit format
commit_regex='^(feat|fix|docs|style|refactor|test|chore)(\(.+\))?: .{1,50}'

if ! echo "$commit_msg" | head -1 | grep -qE "$commit_regex"; then
    echo "‚ùå Invalid commit message format!"
    echo ""
    echo "Expected format: <type>[scope]: <description>"
    echo ""
    echo "Types:"
    echo "  feat:     New feature"
    echo "  fix:      Bug fix"
    echo "  docs:     Documentation changes"
    echo "  style:    Code style/formatting"
    echo "  refactor: Code refactoring"
    echo "  test:     Test changes"
    echo "  chore:    Maintenance tasks"
    echo ""
    echo "Examples:"
    echo "  feat: adiciona comando make backup-all"
    echo "  fix: corrige erro de conex√£o PostgreSQL"
    echo "  docs: atualiza guia de instala√ß√£o"
    echo ""
    echo "Your message: $commit_msg"
    exit 1
fi

# Check message length
first_line=$(echo "$commit_msg" | head -1)
if [ ${#first_line} -gt 72 ]; then
    echo "‚ö†Ô∏è  Warning: Commit message first line is longer than 72 characters"
    echo "Consider shortening it for better readability."
fi

echo "‚úÖ Commit message format is valid!"
exit 0